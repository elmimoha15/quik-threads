openapi: 3.0.3
info:
  title: QuikThread API
  description: |
    Python FastAPI backend for QuikThread - Audio/Video to X Thread Generator
    
    This API allows users to:
    - Upload audio/video files or provide URLs (YouTube, TikTok, Instagram, Twitter, etc.)
    - Transcribe media using Deepgram
    - Generate viral X (Twitter) threads using Google Gemini AI
    - Post threads directly to X/Twitter
    - View analytics for posted threads
    
    ## Authentication
    All endpoints (except webhooks and health checks) require Firebase Authentication.
    Include the Firebase ID token in the Authorization header:
    ```
    Authorization: Bearer <firebase-id-token>
    ```
    
    ## Rate Limiting
    API usage is limited by user tier:
    - **Free**: 2 credits/month, 30-minute max duration
    - **Pro**: 50 credits/month, 60-minute max duration, post to X
    - **Business**: Unlimited credits, 60-minute max duration, post to X, analytics
  version: 1.0.0
  contact:
    name: QuikThread Support
    url: https://quikthread.com
  license:
    name: Proprietary

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.quikthread.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Users
    description: User profile and quota management
  - name: Upload
    description: File upload endpoints
  - name: Process
    description: Audio/video processing and job management
  - name: Transcription
    description: Audio transcription endpoints
  - name: Threads
    description: Thread generation endpoints
  - name: Twitter
    description: X/Twitter integration
  - name: Analytics
    description: Analytics dashboard (Business tier only)
  - name: Webhooks
    description: Payment webhook handlers

components:
  securitySchemes:
    FirebaseAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID token obtained from Firebase Authentication

  schemas:
    Error:
      type: object
      properties:
        detail:
          oneOf:
            - type: string
            - type: object
          description: Error message or detailed error object
      required:
        - detail

    UserFeatures:
      type: object
      properties:
        postToX:
          type: boolean
          description: Can post directly to X/Twitter
        analytics:
          type: boolean
          description: Access to analytics dashboard

    UserProfile:
      type: object
      properties:
        userId:
          type: string
          description: Unique user identifier
        email:
          type: string
          format: email
          description: User email address
        tier:
          type: string
          enum: [free, pro, business]
          description: User subscription tier
        creditsUsed:
          type: integer
          minimum: 0
          description: Credits used this billing period
        maxCredits:
          type: integer
          minimum: 1
          description: Maximum credits per billing period
        maxDuration:
          type: integer
          minimum: 1
          description: Maximum audio duration in seconds
        features:
          $ref: '#/components/schemas/UserFeatures'
        resetDate:
          type: string
          format: date-time
          description: Date when credits reset
        createdAt:
          type: string
          format: date-time
          description: Account creation timestamp
        updatedAt:
          type: string
          format: date-time
          nullable: true
          description: Last update timestamp

    QuotaInfo:
      type: object
      properties:
        creditsUsed:
          type: integer
          minimum: 0
        maxCredits:
          type: integer
          minimum: 1
        remaining:
          type: integer
          minimum: 0
        tier:
          type: string
          enum: [free, pro, business]
        resetDate:
          type: string
          format: date-time

    ProcessRequest:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [upload, url]
          description: Type of input - 'upload' for Firebase Storage URL or 'url' for direct URL
        fileUrl:
          type: string
          format: uri
          description: Firebase Storage URL for uploaded files (required if type=upload)
        contentUrl:
          type: string
          format: uri
          description: Direct URL to audio/video content (required if type=url). Supports YouTube, TikTok, Instagram, Twitter, Facebook, Vimeo, Twitch, Spotify, and podcasts.

    JobStatus:
      type: object
      properties:
        jobId:
          type: string
          description: Unique job identifier
        status:
          type: string
          enum: [processing, transcribing, generating, completed, failed]
          description: Current job status
        progress:
          type: integer
          minimum: 0
          maximum: 100
          description: Progress percentage (0-100)
        type:
          type: string
          description: Type of job - 'upload' or 'url'
        duration:
          type: number
          format: float
          nullable: true
          description: Audio/video duration in seconds
        threads:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/Thread'
          description: Generated thread options
        error:
          type: string
          nullable: true
          description: Error message if job failed
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
          nullable: true

    TranscriptionRequest:
      type: object
      required:
        - audio_url
      properties:
        audio_url:
          type: string
          format: uri
          description: URL to audio/video file

    TranscriptionResponse:
      type: object
      properties:
        transcript:
          type: string
          description: Transcribed text
        duration:
          type: number
          format: float
          description: Audio duration in seconds
        word_count:
          type: integer
          description: Number of words in transcript
        success:
          type: boolean
        error:
          type: string
          nullable: true

    ThreadGenerationRequest:
      type: object
      required:
        - transcript
      properties:
        transcript:
          type: string
          minLength: 10
          maxLength: 50000
          description: Text transcript to generate threads from

    Thread:
      type: object
      properties:
        threadNumber:
          type: integer
          description: Thread option number (1-5)
        hook:
          type: string
          description: Description of the hook strategy used
        tweets:
          type: array
          items:
            type: string
          description: Array of tweet texts that form the thread

    ThreadGenerationResponse:
      type: object
      properties:
        threads:
          type: array
          items:
            $ref: '#/components/schemas/Thread'
          description: Generated thread options (typically 5)
        success:
          type: boolean
        message:
          type: string
        error:
          type: string
          nullable: true

    PostThreadRequest:
      type: object
      required:
        - jobId
        - threadIndex
      properties:
        jobId:
          type: string
          description: Job ID containing the thread to post
        threadIndex:
          type: integer
          minimum: 0
          description: Index of the thread to post (0-4)

    EngagementPoint:
      type: object
      properties:
        date:
          type: string
          format: date
          description: Date in YYYY-MM-DD format
        engagements:
          type: integer
          minimum: 0

    TopPost:
      type: object
      properties:
        title:
          type: string
          description: First tweet text (truncated)
        engagement:
          type: integer
          minimum: 0
        threadUrl:
          type: string
          format: uri
        postedAt:
          type: string
          format: date-time

    AnalyticsData:
      type: object
      properties:
        totalImpressions:
          type: integer
          minimum: 0
        totalReach:
          type: integer
          minimum: 0
        totalLikes:
          type: integer
          minimum: 0
        totalEngagements:
          type: integer
          minimum: 0
        weekOverWeekGrowth:
          type: number
          format: float
          description: Percentage change from last week
        postsThisWeek:
          type: integer
          minimum: 0
        engagementTrend:
          type: array
          items:
            $ref: '#/components/schemas/EngagementPoint'
          description: Daily engagement for last 7 days
        topPosts:
          type: array
          items:
            $ref: '#/components/schemas/TopPost'
          description: Top 5 posts by engagement
        lastUpdated:
          type: string
          format: date-time
        cached:
          type: boolean
          description: Whether data was served from cache

    UploadLimits:
      type: object
      properties:
        maxDuration:
          type: integer
          description: Maximum duration in seconds
        maxDurationMinutes:
          type: number
          description: Maximum duration in minutes
        minFileSize:
          type: integer
          description: Minimum file size in bytes
        maxFileSize:
          type: integer
          description: Maximum file size in bytes
        minFileSizeMB:
          type: number
          description: Minimum file size in MB
        maxFileSizeMB:
          type: number
          description: Maximum file size in MB
        allowedFormats:
          type: array
          items:
            type: string
          description: Allowed file extensions
        tier:
          type: string
          enum: [free, pro, business]

paths:
  /:
    get:
      tags:
        - Health
      summary: Root endpoint
      description: Returns basic API information
      responses:
        '200':
          description: API information
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  version:
                    type: string
                  environment:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check if the backend service is healthy
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  environment:
                    type: string

  /api/health:
    get:
      tags:
        - Health
      summary: API health check
      description: Check if the API service is healthy
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  environment:
                    type: string

  /api/users/me:
    get:
      tags:
        - Users
      summary: Get current user profile
      description: Retrieve the authenticated user's profile
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    type: object
                    description: User data from Firebase token
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/users/init:
    post:
      tags:
        - Users
      summary: Initialize user profile
      description: Create user profile in Firestore if it doesn't exist. Should be called on first login/signup.
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: User profile initialized
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    $ref: '#/components/schemas/UserProfile'
                  message:
                    type: string
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/users/profile:
    get:
      tags:
        - Users
      summary: Get user profile
      description: Retrieve the current user's full profile from Firestore
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  user:
                    $ref: '#/components/schemas/UserProfile'
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/users/quota:
    get:
      tags:
        - Users
      summary: Get user quota
      description: Get current user's credit usage and limits
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Quota information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuotaInfo'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/upload:
    post:
      tags:
        - Upload
      summary: Upload audio/video file
      description: |
        Upload an audio or video file to Firebase Storage.
        
        **Validation:**
        - Allowed formats: mp3, mp4, m4a, wav, webm
        - Min size: 1MB
        - Max size: 500MB
        - Max duration: 30 min (free), 60 min (pro/business)
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Audio/video file to upload
      responses:
        '200':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  fileUrl:
                    type: string
                    format: uri
                    description: Firebase Storage URL
                  fileName:
                    type: string
                  size:
                    type: integer
                    description: File size in bytes
                  duration:
                    type: number
                    format: float
                    description: Audio duration in seconds
                  message:
                    type: string
        '400':
          description: Invalid file or duration exceeds limit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Upload failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/upload/limits:
    get:
      tags:
        - Upload
      summary: Get upload limits
      description: Get upload limits for the current user based on their tier
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Upload limits
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  limits:
                    $ref: '#/components/schemas/UploadLimits'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to retrieve limits
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/upload/health:
    get:
      tags:
        - Upload
      summary: Upload service health
      description: Check upload service health and configuration
      responses:
        '200':
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                  maxFileSize:
                    type: string
                  allowedFormats:
                    type: array
                    items:
                      type: string

  /api/process:
    post:
      tags:
        - Process
      summary: Process audio/video
      description: |
        Create a processing job to transcribe audio/video and generate X threads.
        
        **Process:**
        1. Extract media URL (if social media URL)
        2. Transcribe using Deepgram
        3. Generate threads using Gemini AI
        
        **Quota:** Automatically checks and deducts 1 credit.
        
        **Polling:** Use GET /api/jobs/{jobId} to check status.
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProcessRequest'
      responses:
        '202':
          description: Job created and processing started
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  jobId:
                    type: string
                    description: Job ID for tracking progress
                  message:
                    type: string
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Quota exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to create job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/jobs/{job_id}:
    get:
      tags:
        - Process
      summary: Get job status
      description: Get the current status and results of a processing job
      security:
        - FirebaseAuth: []
      parameters:
        - name: job_id
          in: path
          required: true
          schema:
            type: string
          description: Job ID returned from POST /api/process
      responses:
        '200':
          description: Job status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobStatus'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied - job belongs to another user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to retrieve job
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/jobs:
    get:
      tags:
        - Process
      summary: Get user jobs
      description: Get all jobs for the current user (last 50)
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: List of jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/JobStatus'
                  count:
                    type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to retrieve jobs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/transcribe:
    post:
      tags:
        - Transcription
      summary: Transcribe audio
      description: Transcribe audio/video from URL using Deepgram
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TranscriptionRequest'
      responses:
        '200':
          description: Transcription successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranscriptionResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Transcription failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/generate-threads:
    post:
      tags:
        - Threads
      summary: Generate X threads
      description: Generate 5 viral X thread options from a transcript using Gemini AI
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThreadGenerationRequest'
      responses:
        '200':
          description: Threads generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThreadGenerationResponse'
        '400':
          description: Invalid transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Thread generation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/generate-threads-test:
    post:
      tags:
        - Threads
      summary: Generate threads (test mode)
      description: Test endpoint for thread generation without authentication. FOR DEVELOPMENT ONLY!
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThreadGenerationRequest'
      responses:
        '200':
          description: Threads generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ThreadGenerationResponse'
        '400':
          description: Invalid transcript
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Thread generation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/threads/health:
    get:
      tags:
        - Threads
      summary: Threads service health
      description: Check threads service health and Gemini API configuration
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  service:
                    type: string
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string

  /api/twitter/post:
    post:
      tags:
        - Twitter
      summary: Post thread to X
      description: |
        Post a generated thread to X (Twitter).
        
        **Requires:** Pro or Business tier
        
        **Note:** Twitter API credentials must be configured on the backend.
      security:
        - FirebaseAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PostThreadRequest'
      responses:
        '200':
          description: Thread posted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  postId:
                    type: string
                  threadUrl:
                    type: string
                    format: uri
                  tweetIds:
                    type: array
                    items:
                      type: string
                  tweetCount:
                    type: integer
                  message:
                    type: string
        '400':
          description: Invalid request or job not completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Feature not available for user's tier
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Job not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to post thread
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Twitter API not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/twitter/posts:
    get:
      tags:
        - Twitter
      summary: Get user posts
      description: Get all posts for the current user (last 50)
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: List of posts
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  posts:
                    type: array
                    items:
                      type: object
                      properties:
                        postId:
                          type: string
                        userId:
                          type: string
                        jobId:
                          type: string
                        threadIndex:
                          type: integer
                        tweetIds:
                          type: array
                          items:
                            type: string
                        threadUrl:
                          type: string
                        tweetCount:
                          type: integer
                        postedAt:
                          type: string
                          format: date-time
                        status:
                          type: string
                  count:
                    type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Feature not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to retrieve posts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/twitter/health:
    get:
      tags:
        - Twitter
      summary: Twitter service health
      description: Check Twitter/X integration health and configuration
      responses:
        '200':
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                  configured:
                    type: boolean

  /api/analytics:
    get:
      tags:
        - Analytics
      summary: Get analytics dashboard
      description: |
        Get analytics data for all posted threads.
        
        **Requires:** Business tier
        
        **Caching:** Results are cached for 1 hour.
        
        **Metrics:**
        - Total impressions, reach, likes, engagements
        - Week-over-week growth
        - Posts this week
        - Daily engagement trend (last 7 days)
        - Top 5 posts by engagement
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Analytics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalyticsData'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Feature not available for user's tier
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to retrieve analytics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '503':
          description: Analytics service not configured
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/analytics/cache:
    delete:
      tags:
        - Analytics
      summary: Clear analytics cache
      description: Force fresh analytics calculation on next request
      security:
        - FirebaseAuth: []
      responses:
        '200':
          description: Cache cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Feature not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Failed to clear cache
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/analytics/health:
    get:
      tags:
        - Analytics
      summary: Analytics service health
      description: Check analytics service health and configuration
      responses:
        '200':
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                  configured:
                    type: boolean

  /api/webhooks/polar:
    post:
      tags:
        - Webhooks
      summary: Polar.sh webhook handler
      description: |
        Handle payment webhook events from Polar.sh.
        
        **No authentication required** - uses signature verification.
        
        **Supported events:**
        - checkout.created / checkout.updated: Upgrade user tier
        - subscription.cancelled: Downgrade to free tier
      parameters:
        - name: webhook-signature
          in: header
          required: true
          schema:
            type: string
          description: Webhook signature for verification
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Polar.sh webhook event payload
      responses:
        '200':
          description: Webhook received
          content:
            application/json:
              schema:
                type: object
                properties:
                  received:
                    type: boolean
                  error:
                    type: string
                    nullable: true
        '400':
          description: Invalid payload
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '401':
          description: Invalid signature
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

  /api/webhooks/polar/health:
    get:
      tags:
        - Webhooks
      summary: Webhook health check
      description: Check webhook endpoint health and configuration
      responses:
        '200':
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                  configured:
                    type: boolean
